---
title: "SURV727 Final Project"
author: "Akari Oya, Zhouer Wang"
format: html
---

## Proposal:
weather data vs gtrends data for seasonal depression-related words

From Open Meteo API
```{r}
# Load necessary package
library(openmeteo)

# see which weather variables we have data for
weather_variables()

# Code for pulling one city's dataset
aa_weather <- weather_history("Ann Arbor",
  start = "2020-01-01",
  end = "2021-12-31",
  daily = "daylight_duration")


# Create loop to grab all cities of interest
# First, create list of cities of interest
cities <- c("East Lansing", "Grand Rapids", "Detroit", "Midland", "Traverse City", "Flint")

for(i in cities) {
rest_weather <- weather_history(i,
  start = "2020-01-01",
  end = "2021-12-31",
  daily = "daylight_duration")
  weather <- cbind(aa_weather, rest_weather)
}
weather

# Create variable for daylight duration in hours since original is in seconds
#AA_weather$duration_hrs <- AA_weather$daily_daylight_duration/60

```

```{r}

library(gtrendsR)
res <- gtrends(c("antidepressants", "depression"), 
               geo = "US-MI", 
               time = "2020-01-01 2020-12-31", 
               low_search_volume = TRUE)
plot(res)

#transform the data.frame into tibble
rest_city <- tibble(res$interest_by_city)

#reshape the data & sort loans column in descending order
city_ranking <- rest_city %>%
  pivot_wider(names_from = keyword, 
              values_from = hits) %>%
  arrange(., desc(loans))

#display first few rows of the ranking to find the highest searched
head(city_ranking)
```

